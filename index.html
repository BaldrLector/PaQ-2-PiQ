<!DOCTYPE html>
<html class="full-height" lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PaQ-2-PiQ</title>
    <meta name="description" content="Material design app landing page template built by TemplateFlip.com"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/mdb.min.css" rel="stylesheet">
    <link href="styles/main.css" rel="stylesheet">
    <link href="styles/photo.css" rel="stylesheet">
    <link href="styles/heatmap.css" rel="stylesheet">
    <link href="styles/switch.css" rel="stylesheet">

    <!-- Filepond stylesheet -->
    <link href="https://unpkg.com/filepond/dist/filepond.css" rel="stylesheet">
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-STXPXN06N9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-STXPXN06N9');
    </script>
  </head>
  <body id="top">
    <header>
      <!-- Navbar-->
      <nav class="navbar navbar-expand-lg navbar-dark fixed-top scrolling-navbar" id="navbar">
        <div class="container"><a class="navbar-brand" href="#"><strong>PaQ-2-PiQ</strong></a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
          <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item"><a class="nav-link active" href="#offline-demo">Results</a></li>
              <li class="nav-item"><a class="nav-link active" href="#upload-image">Network</a></li>
              <li class="nav-item"><a class="nav-link active" href="#download-database">Database</a></li>
              <!-- <li class="nav-item"><a class="nav-link active" href="#features">Features</a></li> -->
              <!-- <li class="nav-item"><a class="nav-link active" href="#screenshots">Screenshots</a></li>
              <li class="nav-item"><a class="nav-link" href="#pricing">Pricing</a></li> -->
              <!-- <li class="nav-item"><a class="nav-link" href="#team">Team</a></li>
              <li class="nav-item"><a class="nav-link" href="#client">Client</a></li>
              <li class="nav-item"><a class="nav-link" href="#contact">Contact</a></li> -->
            </ul><a class="btn btn-default btn-rounded my-0" href="#download-database">Download</a>
          </div>
        </div>
      </nav>

<section class="py-5 special-color-dark text-white" id="about">
  <div class="container">
    <div class="wow fadeIn">
      <h2 class="h1 h1-responsive text-center my-5">From Patches to Pictures (PaQ-2-PiQ): <br/>Mapping the Perceptual Space of Picture Quality</h2>
      <p class="lead blue-grey-text text-center w-responsive mx-auto mb-5">
        <div align = "center">
          <div class="authorname" style="font-size:large;line-adjust:0">
            Zhenqiang Ying<sup>1*</sup>,
            Haoran Niu<sup>1*</sup>,
            Praful Gupta<sup>1</sup>,
            Dhruv Mahajan<sup>2</sup>,
            Deepti Ghadiyaram<sup>2+</sup>,
            Alan Bovik<sup>1+</sup>,
          </div>
          <div class="authoraddress" style="line-adjust:0">
            <sup>1</sup>University of Texas at Austin,
            <sup>2</sup>Facebook AI</div>
          <div class="authoremail email" style="line-adjust:0">
            {zqying, haoranniu, praful gupta}@utexas.edu, {dhruvm, deeptigp}@fb.com, bovik@ece.utexas.edu
          </div>
        </div>

        <div class="wow zoomIn text-center">

            <!-- <p class="h4 h4-responsive pt-5 pb-2 text-center"> -->
            <br/>
            <a href="https://github.com/baidut/PaQ-2-PiQ" class="btn btn-secondary">
            <i class="fa fa-github "></i>
             Souce code available
             </a>
             <br/><br/>
          <!-- </p> -->
        </div>
      Blind or no-reference (NR) perceptual picture quality prediction is a difficult, unsolved problem of great consequence to the social and streaming media industries that impacts billions of viewers daily. Unfortunately, popular NR prediction models perform poorly on real-world distorted pictures. To advance progress on this problem, we introduce the largest (by far) subjective picture quality database, containing about 40000 real-world distorted pictures and 120000 patches, on which we collected about 4M human judgments of picture quality. Using these picture and patch quality labels, we built deep region-based architectures that learn to produce state-of-the-art global picture quality predictions as well as useful local picture quality maps. Our innovations include picture quality prediction architectures that produce global-to-local inferences as well as local-to-global inferences (via feedback).
    </p>
    </div>
</section>



<section class="py-5 grey lighten-4" id="offline-demo">
  <div class="container">
    <div class="wow fadeInUp">
      <h2 class="h1 h1-responsive text-center my-5">Picture Quality Map Prediction</h2>
      <p class="lead blue-grey-text text-center w-responsive mx-auto mb-5">
        Generated by RoIPoolModel w/ 32x32 partition
      </p>
    </div>


<!-- Photo Grid -->
<div class="row">
  <div class="column wow fadeInLeft">
    <img class="hovertoggle" src="demo/out_of_focus0470_raw.jpg" style="width:100%">
    <img class="hovertoggle" src="demo/6862937532_raw.jpg" style="width:100%">
    <!-- <img class="hovertoggle" src="demo/4462477090_raw.jpg" style="width:100%"> -->
    <!-- <img class="hovertoggle" src="demo/56_raw.jpg" style="width:100%"> -->
  </div>
  <div class="column wow fadeInLeft">
    <img class="hovertoggle" src="demo/2017266_raw.jpg" style="width:100%">
<!--     <img class="hovertoggle" src="demo/4582906874_raw.jpg" style="width:100%">
    <img class="hovertoggle" src="demo/6596306_raw.jpg" style="width:100%">
    <img class="hovertoggle" src="demo/4841257153_raw.jpg" style="width:100%"> -->
    <!-- <img class="hovertoggle" src="demo/4491574274_raw.jpg" style="width:100%"> -->
    <!-- <img class="hovertoggle" src="demo/6537150655_raw.jpg" style="width:100%"> -->
    <!-- <img class="hovertoggle" src="demo/7384140824_raw.jpg" style="width:100%"> -->
    <!-- <img class="hovertoggle" src="demo/5005558786_raw.jpg" style="width:100%"> -->
    <!-- <img class="hovertoggle" src="demo/299519765_raw.jpg" style="width:100%"> -->
    <img class="hovertoggle" src="demo/motion0160_raw.jpg" style="width:100%">
    <img class="hovertoggle" src="demo/motion0089_raw.jpg" style="width:100%">
  </div>
  <div class="column wow fadeInRight">
    <img class="hovertoggle" src="demo/out_of_focus0385_raw.jpg" style="width:100%">
    <img class="hovertoggle" src="demo/out_of_focus0161_raw.jpg" style="width:100%">
    <img class="hovertoggle" src="demo/out_of_focus0083_raw.jpg" style="width:100%">
  </div>
  <div class="column wow fadeInRight">
    <img class="hovertoggle" src="demo/motion0022_raw.jpg" style="width:100%">
    <img class="hovertoggle" src="demo/motion0072_raw.jpg" style="width:100%">
    <!-- <img class="hovertoggle" src="demo/4904294830_raw.jpg" style="width:100%"> -->
  </div>
</div>
</section>

<section class="text-center" id="upload-image">
  <div>
    <div class="container my-5">

      <div class="wow fadeInUp">
        <form method="post" action="" enctype="multipart/form-data"
                id="myform">
          <h2 class="h1 h1-responsive pt-5 pb-2 text-center">
           <i class="fa fa-cloud-upload ">  <!-- fa-5x  -->
            </i>
            Upload Your Image
          </h2>
        </form>

        <!-- <p>Hover your mouse to see the quality map and local quality predictions :) </p> -->
      </div>
      <input type="file" class="filepond" id='filepond' />

      <div class="progress" style="height: 50px;">
        <div id='score' class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
      </div>

      <div id='image-with-heatmap'>
          <img id='imtest' src='' style="width:100%"></img>
          <div id="heatmap" style="width:100%"></div>
      </div>
      <!-- <div class="justify-content-center py-5"><a href="#"> <img class="img-fluid py-2" src="img/google-play.png" alt="google play logo"/></a><a href="#"> <img class="img-fluid py-2" src="img/app-store.png" alt="app store logo"/></a></div> -->

      <br><br/>

          <!-- Rounded switch -->
          <label class="switch">
            <input type="checkbox" checked id='check_contrast_stretch'>
            <span class="slider round"></span>
          </label>
          <p>Contrast Stretch

          <br/>

          <div class="btn-group" role="group" aria-label="Basic example">
            <button type="button" class="btn btn-secondary" id='btn_im_only'
              data-toggle="tooltip" title="Show image only" >
              Image</button>
            <button type="button" class="btn btn-secondary active" id='btn_im_map'
             data-toggle="tooltip" title="Show both image and heatmap" >
              Both</button>
            <button type="button" class="btn btn-secondary" id='btn_map_only'
              data-toggle="tooltip" title="Show heatmap only" >
              Heatmap</button>
          </div>
    </div>
  </div>
</section>

<section class="text-center special-color-dark text-white" id="download-database">
  <!-- style="background: url('img/app-download.jpg');" -->
  <div class="rgba-teal-light py-5">
    <div class="container my-5">

            <div class="wow fadeInDown">
        <h2 class="h1 h1-responsive pt-5 pb-2 text-center">
          <i class="fa fa-cloud-download "></i>
          Download the database
        </h2>
        <p>Coming soon. </p>
      </div>


      <div class="wow fadeInUp">
        <br/>

      </div>

      <!-- <div class="justify-content-center py-5"><a href="#"> <img class="img-fluid py-2" src="img/google-play.png" alt="google play logo"/></a><a href="#"> <img class="img-fluid py-2" src="img/app-store.png" alt="app store logo"/></a></div> -->
    </div>
  </div>
</section></div>
    <footer class="page-footer special-color-dark">
      <div class="container py-4">
        <div class="row">
          <div class="col-md-12 pb-3">
<!--             <div class="flex-center">
              <i class="fa fa-thumbs-up white-text"></i> Share on social media
              <a class="px-3"><i class="fa fa-facebook fa-lg white-text"></i></a><a class="px-3"><i class="fa fa-twitter fa-lg white-text"></i></a><a class="px-3"><i class="fa fa-google-plus fa-lg white-text"></i></a><a class="px-3"><i class="fa fa-linkedin fa-lg white-text"></i></a></div> -->
          </div>
        </div>
        <div class="container-fluid text-center">
          <!-- <p class="mb-0">&copy; <a href="/">Material App</a>  -->
            - Design: <a href="https://templateflip.com/" target="_blank">TemplateFlip</a></p>
        </div>
      </div>
    </footer>


    <!-- include jQuery library -->
    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="js/popper.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/mdb.min.js"></script>



    <script src="https://unpkg.com/filepond/dist/filepond.js"></script>
    <script src="scripts/plotly-latest.min.js"></script>

    <script type="text/javascript">
// https://stackoverflow.com/questions/11381673/detecting-a-mobile-browser




      function toggle_heatmap() {
        $(this).attr('src', $(this).attr('src').replace("_raw.jpg", "_map.jpg"));
      }
      function toggle_image() {
        $(this).attr('src', $(this).attr('src').replace("_map.jpg", "_raw.jpg"));
      }
      function show_heatmap(){
        $('#heatmap').show();
        $('#imtest').fadeTo(500, 0.2)
      }
      function hide_heatmap(){
        $('#heatmap').hide();
        $('#imtest').fadeTo(500, 1)
      }

      // credit: https://stackoverflow.com/a/58897088/5181908
      function readURL(input) {
        if (input.files && input.files[0]) {
          let img = new Image()
          img.src = window.URL.createObjectURL(input.files[0])
          img.onload = () => {
             // alert(img.width + " " + img.height);

             $('#image-with-heatmap').height(img.height);
             $('#image-with-heatmap').width(img.width);

             // re draw the heatmap
             return img
          }
          // // credit: https://stackoverflow.com/a/4459419/5181908
          // var reader = new FileReader();
          // reader.onload = function(e) {
          //   $('#imtest').attr('src', e.target.result);
          // }
          // reader.readAsDataURL(input.files[0]);
        }
      }

      var mat = [[51.783745, 47.53495 , 51.692028, 51.02082 , 49.804256],
      [67.91715 , 64.76189 , 73.93769 , 80.79623 , 66.441765],
      [77.52105 , 80.15939 , 75.50788 , 74.21228 , 73.43838 ],
      [62.582222, 76.745316, 76.18615 , 70.62961 , 70.1612  ],
      [62.937466, 73.12994 , 74.427986, 70.09519 , 68.26739 ]]

      function draw_heatmap() {
        var data;
       // https://plot.ly/javascript/colorscales/
       //$('#imtest').height()  document.querySelector('#imtest').height
       img = document.querySelector('#imtest')
       height = img.height+25;
       width = img.width;
       absolute_value = document.querySelector('#check_contrast_stretch').checked;

       // https://stackoverflow.com/questions/30610523/reverse-array-in-javascript-without-mutating-original-array
       rev_mat = mat.slice().reverse();

        if(absolute_value){
          data = [
            {
              z: rev_mat,
              type: 'heatmap',
              opacity: 0.8,
              showscale: false
            }
          ];
        }
        else {
          data = [
            {
              z: rev_mat,
              zmin: 40,
              zmax: 100,
              type: 'heatmap',
              opacity: 0.8,
              showscale: false
            }
          ];
        }

        var layout = {
          height: height,
          width: width,
          autosize: true,
          margin: {
            l: 0,
            r: 0,
            b: 0,
            t: 25, // tooltip bar
            pad: 0
          },
          xaxis: {
            showgrid: false,
            zeroline: false,
            showline: false,
            ticks: '',
            showticklabels: false
          },
          yaxis: {
            showgrid: false,
            zeroline: false,
            showline: false,
            ticks: '',
            showticklabels: false
          },
        };
        Plotly.newPlot('heatmap', data, layout);
      }

      function img_upload_success(response) {
         console.log(response);
         var obj = JSON.parse(response);
         // alert(obj.global);
         // $('#score').text(obj.result);
         $('#score').width(obj.result+'%').attr('aria-valuenow', obj.result+'%');
         $('#score').text('Predicted Quality Score: ' + obj.result);
         // re draw the heatmap
         mat = obj.local;
         draw_heatmap();
         // to do, support multiple files
      }
      // const pond = FilePond.create(); // document.querySelector('.filepond');
      FilePond.setOptions({
          maxFiles: 1,
          server: {
              // url: 'http://localhost:8080',
              // url: 'https://10.157.89.130',
              // https gives ERR_CONNECTION_REFUSED
              url: 'https://paq2piq.appspot.com',
              process: {
                  url: '/filepond', // roipool_model  sz
                  method: 'POST',
                  withCredentials: false,
                  crossDomain: true,
                  headers: {},
                  timeout: 7000,
                  onload: img_upload_success,
                  onerror: null,
                  ondata: null,
              }
          }
      });
      FilePond.parse(document.body);
      document.addEventListener('FilePond:loaded', e => {
          console.log('FilePond ready for use', e.detail);
          const inputElement = document.querySelector('#filepond');
          const pond = FilePond.create( inputElement );

          pond.on('addfile', (error, file) => {
              if (error) {
                  console.log('Oh no');
                  return;
              }
              //console.log('File added', file);
              f = window.URL.createObjectURL(pond.getFile().file)
              //console.log(pond.getFile().file)
              //console.log(f)
              // let img = new Image()
              img = document.querySelector('#imtest');
              img.src = f
              img.onload = () => {
                 // alert(img.width + " " + img.height);
                 $('#image-with-heatmap').height(img.height);
                 $('#image-with-heatmap').width(img.width);
              }
          });
      });

      $(document).ready(function(){
        var isMobile = {
           Android: function() {
               return navigator.userAgent.match(/Android/i);
           },
           BlackBerry: function() {
               return navigator.userAgent.match(/BlackBerry/i);
           },
           iOS: function() {
               return navigator.userAgent.match(/iPhone|iPad|iPod/i);
           },
           Opera: function() {
               return navigator.userAgent.match(/Opera Mini/i);
           },
           Windows: function() {
               return navigator.userAgent.match(/IEMobile/i) || navigator.userAgent.match(/WPDesktop/i);
           },
           any: function() {
               return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
           }
        };

        // $("#imgUploaded").hover(hide_image, show_image);
        if( isMobile.any() ) {
          // mobile user
          $('.hovertoggle').bind('touchstart', toggle_heatmap).bind('touchend', toggle_image)
          // $('#image-with-heatmap').hover(hide_heatmap, show_heatmap);
          $('#image-with-heatmap').addClass("column");
        }
        else {
          $('.hovertoggle').hover(toggle_heatmap, toggle_image);
          // $('#image-with-heatmap').hover(show_heatmap, hide_heatmap);
        }
        $('#imtest').fadeTo(1000, 0.2);
        $('#btn_im_only').click(function(){ $('#imtest').css('opacity', '1'); $('#heatmap').hide();  }); // $('#imtest').fadeTo(1, 1);
        $('#btn_im_map').click(function(){ $('#heatmap').show(); $('#imtest').css('opacity', '0.2')  }); // $('#imtest').fadeTo(1000, 0.2);
        $('#btn_map_only').click(function(){ $('#heatmap').show(); $('#imtest').css('opacity', '0') });
        $('#check_contrast_stretch').change(draw_heatmap);
        // bootstrap button group active
        // https://jsfiddle.net/Behseini/NsQ2a/
        $(".btn-group > .btn").click(function(){
            $(".btn-group > .btn").removeClass("active");
            $(this).addClass("active");
        });
      });
    </script>
    <!-- <script src="scripts/plotly_heatmap.js"></script> -->
    <script>new WOW().init();</script>
  </body>
</html>
