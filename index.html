<!DOCTYPE html>
<html class="full-height" lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PaQ-2-PiQ</title>
    <meta name="description" content="Material design app landing page template built by TemplateFlip.com"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/mdb.min.css" rel="stylesheet">
    <link href="styles/main.css" rel="stylesheet">
    <link href="styles/photo.css" rel="stylesheet">
    <link href="styles/heatmap.css" rel="stylesheet">
    
    <!-- Filepond stylesheet -->
    <link href="https://unpkg.com/filepond/dist/filepond.css" rel="stylesheet">
  </head>
  <body id="top">
    <header>
      <!-- Navbar-->
      <nav class="navbar navbar-expand-lg navbar-dark fixed-top scrolling-navbar" id="navbar">
        <div class="container"><a class="navbar-brand" href="#"><strong>PaQ-2-PiQ</strong></a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
          <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item"><a class="nav-link active" href="#offline-demo">Results</a></li>
              <li class="nav-item"><a class="nav-link active" href="#upload-image">Network</a></li>
              <li class="nav-item"><a class="nav-link active" href="#download-database">Database</a></li>
              <!-- <li class="nav-item"><a class="nav-link active" href="#features">Features</a></li> -->
              <!-- <li class="nav-item"><a class="nav-link active" href="#screenshots">Screenshots</a></li>
              <li class="nav-item"><a class="nav-link" href="#pricing">Pricing</a></li> -->
              <!-- <li class="nav-item"><a class="nav-link" href="#team">Team</a></li>
              <li class="nav-item"><a class="nav-link" href="#client">Client</a></li>
              <li class="nav-item"><a class="nav-link" href="#contact">Contact</a></li> -->
            </ul><a class="btn btn-default btn-rounded my-0" href="#">Download</a>
          </div>
        </div>
      </nav>
      
<section class="py-5 special-color-dark text-white" id="about">
  <div class="container">
    <div class="wow fadeIn">
      <h2 class="h1 h1-responsive text-center my-5">From Patches to Pictures (PaQ-2-PiQ): <br/>Mapping the Perceptual Space of Picture Quality</h2>
      <p class="lead blue-grey-text text-center w-responsive mx-auto mb-5">
        <div align = "center">
          <div class="authorname" style="font-size:large;line-adjust:0">
            Zhenqiang Ying<sup>1*</sup>, 
            Haoran Niu<sup>1*</sup>, 
            Praful Gupta<sup>1</sup>, 
            Dhruv Mahajan<sup>2</sup>, 
            Deepti Ghadiyaram<sup>2+</sup>, 
            Alan Bovik<sup>1+</sup>, 
          </div>
          <div class="authoraddress" style="line-adjust:0">
            <sup>1</sup>University of Texas at Austin,
            <sup>2</sup>Facebook AI</div>
          <div class="authoremail email" style="line-adjust:0">
            {zqying, haoranniu, praful gupta}@utexas.edu, {dhruvm, deeptigp}@fb.com, bovik@ece.utexas.edu
          </div>
          <br/>
          <a href="https://github.com/baidut/PaQ-2-PiQ">Source Code (Coming soon)</a>
        </div>


      Blind or no-reference (NR) perceptual picture quality prediction is a difficult, unsolved problem of great consequence to the social and streaming media industries that impacts billions of viewers daily. Unfortunately, popular NR prediction models perform poorly on real-world distorted pictures. To advance progress on this problem, we introduce the largest (by far) subjective picture quality database, containing about 40000 real-world distorted pictures and 120000 patches, on which we collected about 4M human judgments of picture quality. Using these picture and patch quality labels, we built deep region-based architectures that learn to produce state-of-the-art global picture quality predictions as well as useful local picture quality maps. Our innovations include picture quality prediction architectures that produce global-to-local inferences as well as local-to-global inferences (via feedback).
    </p>
    </div>
</section>



<section class="py-5 grey lighten-4" id="offline-demo">
  <div class="container">
    <div class="wow fadeInUp">
      <h2 class="h1 h1-responsive text-center my-5">Picture Quality Map Prediction</h2>
      <p class="lead blue-grey-text text-center w-responsive mx-auto mb-5">
        Generated by RoIPoolModel w/ 32x32 partition
      </p>
    </div>


<!-- Photo Grid -->
<div class="row"> 
  <div class="column wow fadeInLeft">
    <img class="toggle" src="demo/out_of_focus0470_raw.jpg" style="width:100%">
    <img class="toggle" src="demo/6862937532_raw.jpg" style="width:100%">
    <!-- <img class="toggle" src="demo/4462477090_raw.jpg" style="width:100%"> -->
    <!-- <img class="toggle" src="demo/56_raw.jpg" style="width:100%"> -->
  </div>  
  <div class="column wow fadeInLeft">
    <img class="toggle" src="demo/2017266_raw.jpg" style="width:100%">
<!--     <img class="toggle" src="demo/4582906874_raw.jpg" style="width:100%">
    <img class="toggle" src="demo/6596306_raw.jpg" style="width:100%">
    <img class="toggle" src="demo/4841257153_raw.jpg" style="width:100%"> -->
    <!-- <img class="toggle" src="demo/4491574274_raw.jpg" style="width:100%"> -->
    <!-- <img class="toggle" src="demo/6537150655_raw.jpg" style="width:100%"> -->
    <!-- <img class="toggle" src="demo/7384140824_raw.jpg" style="width:100%"> -->
    <!-- <img class="toggle" src="demo/5005558786_raw.jpg" style="width:100%"> -->
    <!-- <img class="toggle" src="demo/299519765_raw.jpg" style="width:100%"> -->
    <img class="toggle" src="demo/motion0160_raw.jpg" style="width:100%">
    <img class="toggle" src="demo/motion0089_raw.jpg" style="width:100%">
  </div>
  <div class="column wow fadeInRight">
    <img class="toggle" src="demo/out_of_focus0385_raw.jpg" style="width:100%">
    <img class="toggle" src="demo/out_of_focus0161_raw.jpg" style="width:100%">
    <img class="toggle" src="demo/out_of_focus0083_raw.jpg" style="width:100%">
  </div>
  <div class="column wow fadeInRight">
    <img class="toggle" src="demo/motion0022_raw.jpg" style="width:100%">
    <img class="toggle" src="demo/motion0072_raw.jpg" style="width:100%">
    <!-- <img class="toggle" src="demo/4904294830_raw.jpg" style="width:100%"> -->
  </div>
</div>
</section>

<section class="text-center" id="upload-image">
  <div>
    <div class="container my-5">

      <div class="wow fadeInUp">
        <form method="post" action="" enctype="multipart/form-data"
                id="myform">
        <label>
          <h2 class="h1 h1-responsive pt-5 pb-2 text-center">
           <i class="fa fa-cloud-upload ">  <!-- fa-5x  -->
              <input type='file' id="imgInp" style="display:none" />
            </i>
            Upload Your Image
          </h2>
        </label>
        </form>
        
        <p>Under construction. Please ignore the current results. Coming soon :) </p>
      </div>
      <input type="file" class="filepond" id='filepond'>

        <div id='image-with-heatmap'>
          <img id='imtest' src='#'></img>
          <div id="heatmap"></div>
      </div>
      <!-- <div class="justify-content-center py-5"><a href="#"> <img class="img-fluid py-2" src="img/google-play.png" alt="google play logo"/></a><a href="#"> <img class="img-fluid py-2" src="img/app-store.png" alt="app store logo"/></a></div> -->
    </div>
  </div>
</section>

<section class="text-center special-color-dark text-white" id="download-database">
  <!-- style="background: url('img/app-download.jpg');" -->
  <div class="rgba-teal-light py-5">
    <div class="container my-5">

            <div class="wow fadeInDown">
        <h2 class="h1 h1-responsive pt-5 pb-2 text-center">
          <i class="fa fa-cloud-download "></i>
          Download the database
        </h2>
        <p>Coming soon. </p>
      </div>


      <div class="wow fadeInUp">
        <br/>

      </div>
      
      <!-- <div class="justify-content-center py-5"><a href="#"> <img class="img-fluid py-2" src="img/google-play.png" alt="google play logo"/></a><a href="#"> <img class="img-fluid py-2" src="img/app-store.png" alt="app store logo"/></a></div> -->
    </div>
  </div>
</section></div>
    <footer class="page-footer special-color-dark">
      <div class="container py-4">
        <div class="row">
          <div class="col-md-12 pb-3">
<!--             <div class="flex-center">
              <i class="fa fa-thumbs-up white-text"></i> Share on social media
              <a class="px-3"><i class="fa fa-facebook fa-lg white-text"></i></a><a class="px-3"><i class="fa fa-twitter fa-lg white-text"></i></a><a class="px-3"><i class="fa fa-google-plus fa-lg white-text"></i></a><a class="px-3"><i class="fa fa-linkedin fa-lg white-text"></i></a></div> -->
          </div>
        </div>
        <div class="container-fluid text-center">
          <!-- <p class="mb-0">&copy; <a href="/">Material App</a>  -->
            - Design: <a href="https://templateflip.com/" target="_blank">TemplateFlip</a></p>
        </div>
      </div>
    </footer>


    <!-- include jQuery library -->
    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="js/popper.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/mdb.min.js"></script>
    

    
    <script src="https://unpkg.com/filepond/dist/filepond.js"></script>
    <script src="scripts/plotly-latest.min.js"></script>

    <script type="text/javascript">



      function toggle_heatmap() {
        $(this).attr('src', $(this).attr('src').replace("_raw.jpg", "_map.jpg"));
      }
      function toggle_image() {
        $(this).attr('src', $(this).attr('src').replace("_map.jpg", "_raw.jpg"));
      }
      function show_heatmap(){
        $('#heatmap').show();
        $('#imtest').fadeTo(500, 0.2)
      }
      function hide_heatmap(){
        $('#heatmap').hide();
        $('#imtest').fadeTo(500, 1)
      }
      function show_image(){
        $('#imgUploaded').fadeTo(500, 1)
      }
      function hide_image(){
        $('#imgUploaded').fadeTo(500, 0.2)
      }
      
      // credit: https://stackoverflow.com/a/58897088/5181908
      function readURL(input) {
        if (input.files && input.files[0]) {
          let img = new Image()
          img.src = window.URL.createObjectURL(input.files[0])
          img.onload = () => {
             // alert(img.width + " " + img.height);
             
             $('#image-with-heatmap').height(img.height);
             $('#image-with-heatmap').width(img.width);

             // re draw the heatmap
             return img
          }
          // // credit: https://stackoverflow.com/a/4459419/5181908
          // var reader = new FileReader();
          // reader.onload = function(e) {
          //   $('#imtest').attr('src', e.target.result);
          // }
          // reader.readAsDataURL(input.files[0]);
        }
      }

      function draw_heatmap(height, width) {
        var mat = [[51.783745, 47.53495 , 51.692028, 51.02082 , 49.804256],
       [67.91715 , 64.76189 , 73.93769 , 80.79623 , 66.441765],
       [77.52105 , 80.15939 , 75.50788 , 74.21228 , 73.43838 ],
       [62.582222, 76.745316, 76.18615 , 70.62961 , 70.1612  ],
       [62.937466, 73.12994 , 74.427986, 70.09519 , 68.26739 ]]

        var data = [
          {
            z: mat.reverse(),
            type: 'heatmap',
            opacity: 0.8,
            showscale: false
          }
        ];

        var layout = {
          height: height,
          width: width,
          autosize: true,
          margin: {
            l: 0,
            r: 0,
            b: 0,
            t: 25, // tooltip bar
            pad: 0
          },
          xaxis: {
            showgrid: false,
            zeroline: false,
            showline: false,
            ticks: '',
            showticklabels: false
          },
          yaxis: {
            showgrid: false,
            zeroline: false,
            showline: false,
            ticks: '',
            showticklabels: false
          },
        };
        Plotly.newPlot('heatmap', data, layout);
      }

      function img_upload_success(response) {
         console.log(response);
      }
      // const pond = FilePond.create(); // document.querySelector('.filepond');
      FilePond.setOptions({
          maxFiles: 1,
          server: {
              // url: 'http://localhost:8080', 
              url: 'https://paq2piq.appspot.com',
              process: {
                  url: '/sz',
                  method: 'POST',
                  withCredentials: false,
                  headers: {},
                  timeout: 7000,
                  onload: img_upload_success,
                  onerror: null,
                  ondata: null, 
              }
          }
      });
      FilePond.parse(document.body);
      document.addEventListener('FilePond:loaded', e => {
          console.log('FilePond ready for use', e.detail);
          const inputElement = document.querySelector('#filepond');
          const pond = FilePond.create( inputElement );

          pond.on('addfile', (error, file) => {
              if (error) {
                  console.log('Oh no');
                  return;
              }
              console.log('File added', file);
              f = window.URL.createObjectURL(pond.getFile().file)
              console.log(pond.getFile().file)
              console.log(f)
              // let img = new Image()
              img = document.querySelector('#imtest');
              img.src = f
              img.onload = () => {
                 // alert(img.width + " " + img.height);
                 $('#image-with-heatmap').height(img.height);
                 $('#image-with-heatmap').width(img.width);
                 // re draw the heatmap
                 draw_heatmap(img.height+25, img.width)
              }
          });
      });

      $(document).ready(function(){
        $('.toggle').hover(toggle_heatmap, toggle_image);
        // mobile user
        $('.toggle').bind('touchstart', toggle_heatmap).bind('touchend', toggle_image)
        $('#image-with-heatmap').hover(show_heatmap, hide_heatmap);
        // $("#imgUploaded").hover(hide_image, show_image);

      });
    </script>
    <!-- <script src="scripts/plotly_heatmap.js"></script> -->
    <script>new WOW().init();</script>
  </body>
</html>